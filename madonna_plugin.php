<?php/*Plugin Name: Madonna PluginPlugin URI: noneDescription: Plugin for Madonna web-site.Version: 2.0Author: Dmitry ZabavskyAuthor URI: none*/ add_action( 'init', 'create_madonna_plugin' );function create_madonna_plugin() {    register_post_type( 'madonna_plugins',        array(            'labels' => array(                'name' => 'Товары',                'singular_name' => 'Madonna Review',                'add_new' => 'Добавить товар',                'add_new_item' => 'Add New Madonna Review',                'edit' => 'Edit',                'edit_item' => 'Edit Madonna Review',                'new_item' => 'New Madonna Review',                'view' => 'View',                'view_item' => 'View Madonna Review',                'search_items' => 'Search Madonna Reviews',                'not_found' => 'No Madonna Reviews found',                'not_found_in_trash' => 'No Madonna Reviews found in Trash',                'parent' => 'Parent Madonna Review'            ),            'public' => true,            'menu_position' => 15,            'supports' => array( 'title', 'editor', 'thumbnail' ),            'taxonomies' => array( '' ),            'menu_icon' => plugins_url( 'images/image.png', __FILE__ ),            'has_archive' => true        )    );}add_action( 'add_meta_boxes', 'my_admin' );function my_admin() {    add_meta_box( 'madonna_plugin_meta_box',        'Madonna Plugin Details',        'display_madonna_plugin_meta_box',        'madonna_plugins', 'normal', 'high'    );}function display_madonna_plugin_meta_box( $madonna_plugin ) {    $madonna_color_on_photo = esc_html( get_post_meta( $madonna_plugin->ID, 'madonna_color_on_photo', true ) );    $madonna_metarial = esc_html( get_post_meta( $madonna_plugin->ID, 'madonna_metarial', true ) );    $madonna_more_details = esc_html( get_post_meta( $madonna_plugin->ID, 'madonna_more_details', true ) );    $madonna_available_color = esc_html( get_post_meta( $madonna_plugin->ID, 'madonna_available_color', true ) );    $madonna_size = esc_html( get_post_meta( $madonna_plugin->ID, 'madonna_size', true ) );    $madonna_action = esc_html( get_post_meta( $madonna_plugin->ID, 'madonna_action', true ) );    //$madonna_rating = intval( get_post_meta( $madonna_plugin->ID, 'madonna_rating', true ) );    ?>    <table>        <tr>            <td style="width: 150px">Цвет на фотографии:</td>            <td><input type="text" size="80" name="madonna_product_color_on_photo" value="<?php echo $madonna_color_on_photo; ?>" /></td>        </tr>		<tr>            <td style="width: 150px">Материал:</td>            <td><input type="text" size="80" name="madonna_product_metarial" value="<?php echo $madonna_metarial; ?>" /></td>        </tr>		<tr>            <td style="width: 150px">Дополнительные детали:</td>            <td><input type="text" size="80" name="madonna_product_more_details" value="<?php echo $madonna_more_details; ?>" /></td>        </tr>		<tr>            <td style="width: 150px">Цвет в наличии:</td>            <td><input type="text" size="80" name="madonna_product_available_color" value="<?php echo $madonna_available_color; ?>" /></td>        </tr>		<tr>            <td style="width: 150px">Размер:</td>            <td><input type="text" size="80" name="madonna_product_size" value="<?php echo $madonna_size; ?>" /></td>        </tr>		<tr>            <td style="width: 150px">Акция:</td>            <td>				<input type="radio" <?php if ($madonna_action == "yes") echo "checked='checked'";?> value="yes" name="madonna_product_action"><span> Да </span>				<input type="radio" <?php if ($madonna_action == "no" OR $madonna_action == "") echo "checked='checked'";?> value="no" name="madonna_product_action"><span> Нет</span>			</td>        </tr>        <!--<tr>            <td style="width: 150px">Madonna Rating</td>            <td>                <select style="width: 100px" name="madonna_plugin_rating">                <?php/*                for ( $rating = 5; $rating >= 1; $rating -- ) {                ?>                    <option value="<?php echo $rating; ?>" <?php echo selected( $rating, $madonna_rating ); ?>>                    <?php echo $rating; ?> stars <?php } */?>                </select>            </td>        </tr>-->    </table>    <?php}add_action( 'save_post','add_madonna_plugin_fields', 10, 2 );function add_madonna_plugin_fields( $madonna_plugin_id, $madonna_plugin ) {    // Check post type for movie reviews    if ( $madonna_plugin->post_type == 'madonna_plugins' ) {        // Store data in post meta table if present in post data        if ( isset( $_POST['madonna_product_color_on_photo'] ) && $_POST['madonna_product_color_on_photo'] != '' ) {            update_post_meta( $madonna_plugin_id, 'madonna_color_on_photo', $_POST['madonna_product_color_on_photo'] );        }		if ( isset( $_POST['madonna_product_metarial'] ) && $_POST['madonna_product_metarial'] != '' ) {            update_post_meta( $madonna_plugin_id, 'madonna_metarial', $_POST['madonna_product_metarial'] );        }		if ( isset( $_POST['madonna_product_more_details'] ) && $_POST['madonna_product_more_details'] != '' ) {            update_post_meta( $madonna_plugin_id, 'madonna_more_details', $_POST['madonna_product_more_details'] );        }		if ( isset( $_POST['madonna_product_available_color'] ) && $_POST['madonna_product_available_color'] != '' ) {            update_post_meta( $madonna_plugin_id, 'madonna_available_color', $_POST['madonna_product_available_color'] );        }		if ( isset( $_POST['madonna_product_size'] ) && $_POST['madonna_product_size'] != '' ) {            update_post_meta( $madonna_plugin_id, 'madonna_size', $_POST['madonna_product_size'] );        }		if ( isset( $_POST['madonna_product_size'] ) && $_POST['madonna_product_size'] != '' ) {            update_post_meta( $madonna_plugin_id, 'madonna_size', $_POST['madonna_product_size'] );        }        if ( isset( $_POST['madonna_product_action'] ) && $_POST['madonna_product_action'] != '' ) {            update_post_meta( $madonna_plugin_id, 'madonna_action', $_POST['madonna_product_action'] );        }    }}/* ======================================================================================================================== *//* ======================================================================================================================== *//* ======================================================================================================================== */add_filter( 'template_include', 'include_template_function', 1 );function include_template_function( $template_path ) {    if ( get_post_type() == 'movie_reviews' ) {        if ( is_single() ) {            // checks if the file exists in the theme first,            // otherwise serve the file from the plugin            if ( $theme_file = locate_template( array ( 'single-movie_reviews.php' ) ) ) {                $template_path = $theme_file;            } else {                $template_path = plugin_dir_path( __FILE__ ) . '/single-movie_reviews.php';            }        }    }    return $template_path;}/* ================================================ Отзывы (на главной) ================================================================== */add_action( 'init', 'create_madonna_reviews' );function create_madonna_reviews() {    register_post_type( 'madonna_reviews',        array(            'labels' => array(                'name' => 'Отзывы',                'singular_name' => 'Madonna Review',                'add_new' => 'Добавить',                'add_new_item' => 'Add New Madonna Review',                'edit' => 'Edit',                'edit_item' => 'Edit Madonna Review',                'new_item' => 'New Madonna Review',                'view' => 'View',                'view_item' => 'View Madonna Review',                'search_items' => 'Search Madonna Reviews',                'not_found' => 'No Madonna Reviews found',                'not_found_in_trash' => 'No Madonna Reviews found in Trash',                'parent' => 'Parent Madonna Review'            ),            'public' => true,            'menu_position' => 16,            'supports' => array( 'editor'),            'taxonomies' => array( '' ),            'menu_icon' => plugins_url( 'images/image.png', __FILE__ ),            'has_archive' => true        )    );}/* ================================================ Скидки (на главной) ================================================================== */add_action( 'init', 'create_madonna_discount' );function create_madonna_discount() {    register_post_type( 'madonna_discount',        array(            'labels' => array(                'name' => 'Скидки (на Главной)',                'singular_name' => 'Madonna Discount',                'add_new' => 'Добавить',                'add_new_item' => 'Add New Madonna Review',                'edit' => 'Edit',                'edit_item' => 'Edit Madonna Review',                'new_item' => 'New Madonna Review',                'view' => 'View',                'view_item' => 'View Madonna Review',                'search_items' => 'Search Madonna Reviews',                'not_found' => 'No Madonna Reviews found',                'not_found_in_trash' => 'No Madonna Reviews found in Trash',                'parent' => 'Parent Madonna Review'            ),            'public' => true,            'menu_position' => 17,            'supports' => array( 'editor', 'thumbnail' ),            'taxonomies' => array( '' ),            'menu_icon' => plugins_url( 'images/image.png', __FILE__ ),            'has_archive' => true        )    );}/* ================================================ Новости (на главной) ================================================================== */add_action( 'init', 'create_madonna_newshomepage' );function create_madonna_newshomepage() {    register_post_type( 'madonna_newshomepage',        array(            'labels' => array(                'name' => 'Новости (на Главной)',                'singular_name' => 'Madonna Discount',                'add_new' => 'Добавить',                'add_new_item' => 'Add New Madonna Review',                'edit' => 'Edit',                'edit_item' => 'Edit Madonna Review',                'new_item' => 'New Madonna Review',                'view' => 'View',                'view_item' => 'View Madonna Review',                'search_items' => 'Search Madonna Reviews',                'not_found' => 'No Madonna Reviews found',                'not_found_in_trash' => 'No Madonna Reviews found in Trash',                'parent' => 'Parent Madonna Review'            ),            'public' => true,            'menu_position' => 18,            'supports' => array( 'editor', 'thumbnail' ),            'taxonomies' => array( '' ),            'menu_icon' => plugins_url( 'images/image.png', __FILE__ ),            'has_archive' => true        )    );}/* ================================================ Добавление Категории ================================================================== *//*add_action( 'init', 'create_madonna_taxonomy_product' );function create_madonna_taxonomy(){	$args= array('hierarchical'=>true, 'label'=>'Товары'); //Массив параметров	register_taxonomy('pumpkin-sort', 'pumpkin', $args);}*//*function my_custom_post_product() {	$labels = array(		'name'               => _x( 'Товары', 'post type general name' ),		'singular_name'      => _x( 'Товары', 'post type singular name' ),		'add_new'            => _x( 'Добавить новый', 'book' ),		'add_new_item'       => __( 'Добавить новый товар' ),		'edit_item'          => __( 'Редактировать товар' ),		'new_item'           => __( 'Новый товар' ),		'all_items'          => __( 'Все товары' ),		'view_item'          => __( 'Просмотреть товар' ),		'search_items'       => __( 'Поиск товаров' ),		'not_found'          => __( 'Товар не найден' ),		'not_found_in_trash' => __( 'В корзине не найдено ни одного товара' ), 		'parent_item_colon'  => '',		'menu_name'          => 'Товары'	);	$args = array(		'labels'        => $labels,		'description'   => 'Holds our products and product specific data',		'public'        => true,		'menu_position' => 14,		'supports'      => array( 'title', 'editor', 'thumbnail' ),		'menu_icon'     => plugins_url( 'images/image.png', __FILE__ ),		'has_archive'   => true,	);	register_post_type( 'madonna_product', $args );	}add_action( 'init', 'my_custom_post_product' );*//* ================================================================================================================== *//*	register_taxonomy ( 		'madonna_brend', 		'madonna_plugins', 		array( 			'hierarchical' => true, 			'label' 	   => 'Бренды', 			'query_var'    => true, 			'rewrite'      => true		) 	); */add_action( 'init', 'build_madonna_taxonomies', 0 ); function build_madonna_taxonomies() { 	register_taxonomy ( 		'madonna_section', 		'madonna_plugins', 		array( 			'hierarchical' => true, 			'label' 	   => 'Категории', 			'query_var'    => true, 			'rewrite'      => false		) 	);  		register_taxonomy ( 		'madonna_brend', 		'madonna_plugins', 		array( 			'hierarchical' => true, 			'label' 	   => 'Бренды', 			'query_var'    => true, 			'rewrite'      => false,			'supports' => array(				'post-thumbnails'			)			) 	); }  add_action( 'admin_init', 'cine_register_meta_boxes' );function cine_register_meta_boxes()	{		$meta_boxes[] = array(			'id' => 'cine_film_metabox',			'title' => 'Фотографии продукта',			'pages' => array('madonna_plugins'),			'context' => 'normal',			'priority' => 'low',			'fields' => array(				array(					'name'             => 'Film Covers (up to 4)',					'id'               => "madonna_other_image",					'type'             => 'plupload_image',					'max_file_uploads' => 3,				),				array(					'name'             => 'Film Banner (1000x562)',					'id'               => "madonna_main_image",					'type'             => 'plupload_image',					'max_file_uploads' => 1,				),			),		);		if ( !class_exists( 'RW_Meta_Box' ) )			return;		foreach ( $meta_boxes as $meta_box )		{			new RW_Meta_Box( $meta_box );		}		add_image_size('cine-film-cover-list', 135, 999);		add_image_size('cine-film-cover', 145, 999);		add_image_size('cine-film-placeholder', 1000, 562, true);	}?>